<!DOCTYPE html>
<html>
    <head>
		<title>Form</title>
		<meta charset="utf-8"/>
        <script>
		var ls = window.localStorage;
		var txt = "<table>";
		var date = new Date();
		var time = date.getTime();
		window.onload = () => {
			updateTable();
		}

		function updateTable() {
			for(i = ls.length - 1; i >= 0; i--) {
				txt += "<tr>";
				var data = JSON.parse(ls.getItem(ls.key(i)));
				for(var x in data) {
					txt += "<td>" + data[x] + "</td>";
				}
				txt += "<td><button onclick='updateProduct(this.id)' id='e&" + data['ptime'] + "'>Edit</button></td>";
				txt += "<td><button onclick='deleteProduct(this.id)' id='d&" + data['ptime'] + "'>Delete</button></td>";
				txt += "</tr>";
			}
			txt += "</table>";
			document.getElementById("table").innerHTML = txt;
		}
		//this function saves a certain product in local storage
		function addProduct() {
			var name = document.getElementById("name").value;
			var description = document.getElementById("description").value;
			var photo = document.getElementById("photo").value;
			var featured = document.getElementById("featured").value;
			time = keyChecker(time);
			var product = {
				ptime : time,
				pname : name,
				pdescription : description,
				pphoto : photo,
				pfeatured : featured
			};
			var productInfo = JSON.stringify(product);
			ls.setItem(time, productInfo);
			// loadAllProducts();
		}

		function updateProduct(id) {
			var prod = JSON.parse(ls.getItem(id.split("&")[1]));
			console.log(prod);
			var otime = id.split("&")[1];
			time = parseInt(otime);
			// if(id.split("&")[0] == 'd') {
			// 	ls.removeItem(time);
			// }
			document.getElementById("name").value = prod["pname"];
			document.getElementById("description").value = prod["pdescription"];
			document.getElementById("photo").value = prod["pphoto"];
			document.getElementById("featured").value = prod["pfeatured"];
		}

		function deleteProduct(id) {
			var otime = id.split("&")[1];
			time = parseInt(otime);
			ls.removeItem(time);
		}

		function keyChecker(ptime) {
			for(i = ls.length - 1; i > 0; i--) {
				if(ptime == ls.key(i)) {
					ptime = ls.key(i);
					return ptime;
				}
				else {
					ptime = date.getTime();
				}
			}
			return ptime;
		}
        </script>
    </head>
    <body>
        <div>
            <form id="form-container">
                <div><label>Name</label><input id="name" type="text"/></div>
                <div><label>Decription</label><input id="description" type="text"/></div>
                <div><label>Photo</label><input id="photo" type="text"/></div>
                <div><input id="featured" type="checkbox"/>Featured</div>
                <div><input id="save" type="submit" value="Save/Update" onclick="addProduct();"/></div>
            </form>
        </div>
		<div id="table"></div>
    </body>
</html>
